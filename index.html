<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
  <title>–ù–æ–≤–æ–≥–æ–¥–Ω–µ–µ –ø–æ–∂–µ–ª–∞–Ω–∏–µ</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Great+Vibes&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    /* üîë –ö–õ–Æ–ß–ï–í–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π viewport */
    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      margin: 0;
      padding: 0;
      background: #0d0f1e;
      color: #ffffff;
      font-family: 'Playfair Display', serif;
    }

    #content {
      position: relative;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      overflow: hidden;
      z-index: 20;
    }

    h1 {
      text-align: center;
      padding: 15px 0;
      font-size: 2.6em;
      color: #FFD700;
      text-shadow: 0 0 12px rgba(255, 215, 0, 0.6);
      font-family: 'Great Vibes', cursive;
      font-weight: normal;
      margin: 10px 0;
      letter-spacing: 2px;
    }

    #wish-container {
      width: 90%;
      max-width: 800px;
      max-height: calc(100vh - 320px);
      background: rgba(10, 15, 30, 0.65);
      border: 1px solid rgba(255, 215, 0, 0.2);
      border-radius: 20px;
      backdrop-filter: blur(10px);
      padding: 30px;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      text-align: center;
      font-size: 1.7em;
      line-height: 1.6;
      color: white;
      text-shadow: 0 0 8px rgba(255, 255, 255, 0.4);
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.4);
    }

    #wish-container::-webkit-scrollbar {
      width: 10px;
    }
    #wish-container::-webkit-scrollbar-track {
      background: rgba(0,0,0,0.2);
      border-radius: 5px;
    }
    #wish-container::-webkit-scrollbar-thumb {
      background: #FFD700;
      border-radius: 5px;
    }

    /* =============== COUNTDOWN LABEL =============== */
    #countdown-label {
      position: fixed;
      bottom: 110px;
      width: 100%;
      text-align: center;
      font-size: 1.4em;
      color: #FFD700;
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.6);
      z-index: 24;
      font-family: 'Playfair Display', serif;
      letter-spacing: 1px;
    }

    /* =============== FLIP CLOCK =============== */
    #flip-clock {
      position: fixed;
      bottom: 20px;
      left: 0;
      width: 100%;
      display: flex;
      justify-content: center;
      gap: 8px;
      z-index: 25;
      font-family: 'Courier New', monospace;
    }

    .flip-unit {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 50px;
    }

    .flip-label {
      text-align: center;
      font-size: 0.8em;
      color: #888;
      margin-bottom: 4px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .flip-card {
      position: relative;
      height: 72px;
      width: 100%;
      perspective: 200px;
    }

    .flip-card-inner {
      position: absolute;
      width: 100%;
      height: 100%;
      transform-style: preserve-3d;
      transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
    }

    .flip-card.flipping .flip-card-inner {
      transform: rotateX(-180deg);
    }

    .flip-card-front, .flip-card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 6px;
      font-size: 1.9em;
      font-weight: bold;
      background: rgba(10, 20, 40, 0.85);
      color: #00ffaa;
      border: 1px solid rgba(0, 200, 150, 0.3);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.1);
    }

    .flip-card-back {
      transform: rotateX(180deg);
      color: #00cc99;
      background: rgba(5, 10, 25, 0.9);
    }

    .flip-separator {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8em;
      color: #FFD700;
      height: 72px;
      margin: 0 4px;
    }

    /* =============== GARLAND =============== */
    .garland {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 10;
    }

    .top-lights, .bottom-lights {
      position: absolute;
      width: 100%;
      display: flex;
      justify-content: space-around;
      padding: 0 10px;
    }
    .top-lights { top: 8px; }
    .bottom-lights { bottom: 130px; }

    .left-lights, .right-lights {
      position: absolute;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: space-around;
      padding: 70px 0;
    }
    .left-lights { left: 8px; }
    .right-lights { right: 8px; }

    .bulb {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #222;
      box-shadow: 0 0 3px 1px #222;
    }

    @keyframes blink-red {
      0%, 100% { background: #222; box-shadow: 0 0 3px 1px #222; }
      50% { background: #ff4444; box-shadow: 0 0 10px 4px #ff4444; }
    }
    @keyframes blink-green {
      0%, 100% { background: #222; box-shadow: 0 0 3px 1px #222; }
      50% { background: #44ff44; box-shadow: 0 0 10px 4px #44ff44; }
    }
    @keyframes blink-yellow {
      0%, 100% { background: #222; box-shadow: 0 0 3px 1px #222; }
      50% { background: #ffdd33; box-shadow: 0 0 10px 4px #ffdd33; }
    }
    @keyframes blink-blue {
      0%, 100% { background: #222; box-shadow: 0 0 3px 1px #222; }
      50% { background: #4488ff; box-shadow: 0 0 10px 4px #4488ff; }
    }

    .bulb.red { animation: blink-red 1.6s infinite; }
    .bulb.green { animation: blink-green 1.7s infinite; }
    .bulb.yellow { animation: blink-yellow 1.8s infinite; }
    .bulb.blue { animation: blink-blue 1.9s infinite; }

    /* =============== SNOWFLAKES ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ =============== */
    .snowflake {
      position: absolute;
      top: -20px;
      color: white;
      font-size: 1.2em;
      opacity: 0.85;
      text-shadow: 0 0 6px rgba(255,255,255,0.9);
      user-select: none;
      z-index: 5;
      animation: fall linear forwards;
      /* –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ –Ω–µ –≤—ã–π–¥–µ—Ç –∑–∞ –∫—Ä–∞–π */
      left: 0;
    }

    @keyframes fall {
      to {
        transform: translateY(105vh) rotate(360deg);
      }
    }

    #error {
      text-align: center;
      padding: 40px;
      color: #ff6666;
      font-size: 1.4em;
      max-width: 80%;
      margin: 0 auto;
      text-shadow: 0 0 8px rgba(255,100,100,0.5);
    }

    #sound-toggle {
      position: fixed;
      top: 15px;
      right: 15px;
      font-size: 1.6em;
      color: #FFD700;
      cursor: pointer;
      z-index: 30;
      text-shadow: 0 0 10px rgba(255,215,0,0.7);
      transition: transform 0.2s;
    }
    #sound-toggle:hover {
      transform: scale(1.15);
    }

    /* =============== VK SHARE BUTTON (–≤ —É–≥–ª—É) =============== */
    #vk-share {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 40px;
      height: 40px;
      border: none;
      border-radius: 50%;
      background: linear-gradient(135deg, rgba(74, 118, 168, 0.7), rgba(61, 90, 128, 0.7));
      color: white;
      font-size: 1.3em;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3), 0 0 6px rgba(74, 118, 168, 0.4);
      transition: all 0.25s ease;
      z-index: 28;
    }
    #vk-share:hover {
      background: linear-gradient(135deg, rgba(74, 118, 168, 0.95), rgba(61, 90, 128, 0.95));
      transform: scale(1.15);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4), 0 0 10px rgba(74, 118, 168, 0.7);
    }
    #vk-share i {
      margin: 0;
    }
  </style>
</head>
<body>
  <audio id="bg-music" loop preload="auto">
    <source src="music.mp3" type="audio/mpeg">
  </audio>

  <div id="sound-toggle">
    <i class="fas fa-volume-up"></i>
  </div>

  <div class="garland">
    <div class="top-lights" id="top"></div>
    <div class="bottom-lights" id="bottom"></div>
    <div class="left-lights" id="left"></div>
    <div class="right-lights" id="right"></div>
  </div>

  <div id="content">
    <h1>–° –ù–æ–≤—ã–º –≥–æ–¥–æ–º!</h1>
    <div id="wish-container"></div>
    <div id="error" style="display:none;"></div>
  </div>

  <div id="countdown-label">–î–æ –ù–æ–≤–æ–≥–æ –≥–æ–¥–∞ –æ—Å—Ç–∞–ª–æ—Å—å</div>

  <div id="flip-clock">
    <div class="flip-unit">
      <div class="flip-label">–¥–Ω–∏</div>
      <div class="flip-card" id="days-card">
        <div class="flip-card-inner">
          <div class="flip-card-front">00</div>
          <div class="flip-card-back">00</div>
        </div>
      </div>
    </div>
    <div class="flip-separator">:</div>
    <div class="flip-unit">
      <div class="flip-label">—á–∞—Å—ã</div>
      <div class="flip-card" id="hours-card">
        <div class="flip-card-inner">
          <div class="flip-card-front">00</div>
          <div class="flip-card-back">00</div>
        </div>
      </div>
    </div>
    <div class="flip-separator">:</div>
    <div class="flip-unit">
      <div class="flip-label">–º–∏–Ω</div>
      <div class="flip-card" id="minutes-card">
        <div class="flip-card-inner">
          <div class="flip-card-front">00</div>
          <div class="flip-card-back">00</div>
        </div>
      </div>
    </div>
    <div class="flip-separator">:</div>
    <div class="flip-unit">
      <div class="flip-label">—Å–µ–∫</div>
      <div class="flip-card" id="seconds-card">
        <div class="flip-card-inner">
          <div class="flip-card-front">00</div>
          <div class="flip-card-back">00</div>
        </div>
      </div>
    </div>
  </div>

  <button id="vk-share" onclick="shareToVKStory()" aria-label="–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –≤ —Å—Ç–æ—Ä–∏—Å –í–ö–æ–Ω—Ç–∞–∫—Ç–µ">
    <i class="fab fa-vk"></i>
  </button>

  <script>
    const COLORS = ['red', 'green', 'yellow', 'blue'];
    let musicPlayed = false;

    function generateNonRepeatingColors(count, colors) {
      const result = [];
      let prev = -1;
      for (let i = 0; i < count; i++) {
        let next;
        do {
          next = Math.floor(Math.random() * colors.length);
        } while (next === prev && colors.length > 1);
        result.push(colors[next]);
        prev = next;
      }
      return result;
    }

    function createBulbs(container, count) {
      const colorSequence = generateNonRepeatingColors(count, COLORS);
      for (let i = 0; i < count; i++) {
        const bulb = document.createElement('div');
        bulb.classList.add('bulb', colorSequence[i]);
        bulb.style.animationDelay = `${Math.random() * 2}s`;
        container.appendChild(bulb);
      }
    }

    function initGarland() {
      const topBottomCount = Math.max(8, Math.floor(window.innerWidth / 70));
      const leftRightCount = Math.max(6, Math.floor(window.innerHeight / 80));
      createBulbs(document.getElementById('top'), topBottomCount);
      createBulbs(document.getElementById('bottom'), topBottomCount);
      createBulbs(document.getElementById('left'), leftRightCount);
      createBulbs(document.getElementById('right'), leftRightCount);
    }

    function createSnowflake() {
      const snowflake = document.createElement('div');
      const symbols = ['‚ùÑ', '‚ùÖ', '‚ùÜ'];
      snowflake.innerHTML = symbols[Math.floor(Math.random() * symbols.length)];
      snowflake.classList.add('snowflake');
      // üîë –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏: –æ—Ç 5% –¥–æ 95%
      snowflake.style.left = `${5 + Math.random() * 90}vw`;
      snowflake.style.fontSize = `${Math.random() * 1.2 + 0.5}em`;
      snowflake.style.opacity = `${0.6 + Math.random() * 0.3}`;
      snowflake.style.animationDuration = `${Math.random() * 8 + 4}s`;
      document.body.appendChild(snowflake);
      setTimeout(() => {
        if (snowflake.parentNode) snowflake.parentNode.removeChild(snowflake);
      }, parseFloat(snowflake.style.animationDuration) * 1000);
    }

    async function loadWish() {
      const urlParams = new URLSearchParams(window.location.search);
      const idParam = parseInt(urlParams.get('id'), 10);
      const wishId = idParam && idParam >= 1 ? idParam : 1;

      try {
        const response = await fetch('wishes.txt?' + Date.now());
        if (!response.ok) throw new Error('–§–∞–π–ª wishes.txt –Ω–µ –Ω–∞–π–¥–µ–Ω');
        const text = await response.text();

        const wishes = text
          .split(/^-{3,}$/m)
          .map(w => w.trim())
          .filter(w => w !== '');

        if (wishId > wishes.length) {
          document.getElementById('error').textContent = `‚ùå –ü–æ–∂–µ–ª–∞–Ω–∏–µ ‚Ññ${wishId} –µ—â—ë –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ`;
          document.getElementById('error').style.display = 'block';
          return;
        }

        document.getElementById('wish-container').innerHTML = wishes[wishId - 1].replace(/\n/g, '<br>');
      } catch (err) {
        console.error(err);
        document.getElementById('error').textContent = '‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ–∂–µ–ª–∞–Ω–∏—è';
        document.getElementById('error').style.display = 'block';
      }
    }

    function initMusic() {
      const audio = document.getElementById('bg-music');
      const toggleBtn = document.getElementById('sound-toggle');
      const icon = toggleBtn.querySelector('i');

      function tryPlay() {
        if (!musicPlayed) {
          audio.volume = 0.25;
          const playPromise = audio.play();
          if (playPromise !== undefined) {
            playPromise.catch(() => {}).then(() => {
              musicPlayed = true;
              icon.className = 'fas fa-volume-up';
            });
          }
        }
      }

      document.body.addEventListener('click', tryPlay, { once: true });

      toggleBtn.addEventListener('click', () => {
        if (audio.paused) {
          audio.play();
          icon.className = 'fas fa-volume-up';
        } else {
          audio.pause();
          icon.className = 'fas fa-volume-mute';
        }
      });
    }

    function shareToVKStory() {
      const ogImageUrl = 'https://via.placeholder.com/1080x1920/0d0f1e/FFD700?text=–°+–ù–æ–≤—ã–º+–ì–æ–¥–æ–º!';
      const url = encodeURIComponent(window.location.href);
      const text = encodeURIComponent('–° –ù–æ–≤—ã–º –≥–æ–¥–æ–º! ‚ú®');
      const image = encodeURIComponent(ogImageUrl);
      const storyIntent = `vkstory://create?link=${url}&text=${text}&background_image=${image}`;
      const fallbackUrl = `https://vk.com/share.php?url=${url}&title=${text}&image=${image}&description=–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —ç—Ç–∏–º –ø–æ–∂–µ–ª–∞–Ω–∏–µ–º –≤ —Å—Ç–æ—Ä–∏—Å –í–ö–æ–Ω—Ç–∞–∫—Ç–µ!`;

      window.location.href = storyIntent;
      setTimeout(() => {
        if (!document.hidden) {
          window.open(fallbackUrl, '_blank', 'width=600,height=400');
        }
      }, 1000);
    }

    function pad(num) {
      return num.toString().padStart(2, '0');
    }

    function updateFlipCard(cardEl, newValue) {
      const front = cardEl.querySelector('.flip-card-front');
      const back = cardEl.querySelector('.flip-card-back');
      const oldValue = front.textContent;
      if (oldValue === newValue) return;
      back.textContent = newValue;
      cardEl.classList.add('flipping');
      setTimeout(() => {
        front.textContent = newValue;
        cardEl.classList.remove('flipping');
      }, 300);
    }

    function updateCountdown() {
      const now = new Date();
      const nextNewYear = new Date(`January 1, ${now.getFullYear() + 1} 00:00:00`);
      const diff = nextNewYear - now;

      if (diff <= 0) {
        document.getElementById('countdown-label').style.display = 'none';
        document.getElementById('flip-clock').innerHTML = 
          '<div style="position:fixed;bottom:40px;width:100%;text-align:center;font-size:1.6em;color:#FFD700;text-shadow:0 0 12px rgba(255,215,0,0.8);">–° –ù–æ–≤—ã–º –≥–æ–¥–æ–º! üéâ</div>';
        return;
      }

      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
      const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((diff % (1000 * 60)) / 1000);

      updateFlipCard(document.getElementById('days-card'), pad(days));
      updateFlipCard(document.getElementById('hours-card'), pad(hours));
      updateFlipCard(document.getElementById('minutes-card'), pad(minutes));
      updateFlipCard(document.getElementById('seconds-card'), pad(seconds));
    }

    window.addEventListener('load', () => {
      initGarland();
      loadWish();
      initMusic();
      setInterval(createSnowflake, 400);
      updateCountdown();
      setInterval(updateCountdown, 1000);
    });
  </script>
</body>
</html>