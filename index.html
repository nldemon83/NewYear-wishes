<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ù–æ–≤–æ–≥–æ–¥–Ω–µ–µ –ø–æ–∂–µ–ª–∞–Ω–∏–µ</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      overflow: hidden;
    }

    body {
      background: #a0cfff;
      font-family: 'Georgia', serif;
      position: relative;
      color: #003366;
    }

    #content {
      position: relative;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      overflow: hidden;
      z-index: 20;
    }

    h1 {
      text-align: center;
      padding: 15px 0;
      font-size: 2.2em;
      color: #FFD700;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
      font-weight: bold;
      margin: 10px 0;
      /* –ü–ª–∞–≤–Ω–æ–µ "–¥—ã—Ö–∞–Ω–∏–µ" –∑–∞–≥–æ–ª–æ–≤–∫–∞ */
      animation: breathe 6s infinite ease-in-out;
    }

    @keyframes breathe {
      0%, 100% { transform: scale(1); opacity: 0.9; }
      50% { transform: scale(1.03); opacity: 1; }
    }

    #wish-container {
      width: 90%;
      max-width: 800px;
      /* –£–º–µ–Ω—å—à–µ–Ω–∞ –≤—ã—Å–æ—Ç–∞, —á—Ç–æ–±—ã –Ω–µ –∑–∞—Ö–æ–¥–∏—Ç—å –Ω–∞ –æ–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á—ë—Ç */
      max-height: calc(100vh - 250px);
      background: rgba(255, 255, 255, 0.65);
      border-radius: 16px;
      backdrop-filter: blur(4px);
      padding: 25px;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      text-align: center;
      font-size: 1.6em;
      line-height: 1.5;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    #wish-container::-webkit-scrollbar {
      width: 8px;
    }
    #wish-container::-webkit-scrollbar-track {
      background: rgba(255,255,255,0.3);
      border-radius: 4px;
    }
    #wish-container::-webkit-scrollbar-thumb {
      background: #FFD700;
      border-radius: 4px;
    }

    .garland {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 10;
    }

    .top-lights, .bottom-lights {
      position: absolute;
      width: 100%;
      display: flex;
      justify-content: space-around;
      padding: 0 20px;
    }
    .top-lights { top: 10px; }
    .bottom-lights { bottom: 10px; }

    .left-lights, .right-lights {
      position: absolute;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: space-around;
      padding: 60px 0;
    }
    .left-lights { left: 10px; }
    .right-lights { right: 10px; }

    .bulb {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: white;
      box-shadow: 0 0 6px 2px white;
    }

    @keyframes blink-red { 0%,40%{background:white;box-shadow:0 0 6px 2px white;} 50%,100%{background:#ff3333;box-shadow:0 0 10px 4px #ff3333;} }
    @keyframes blink-green { 0%,40%{background:white;box-shadow:0 0 6px 2px white;} 50%,100%{background:#33cc33;box-shadow:0 0 10px 4px #33cc33;} }
    @keyframes blink-yellow { 0%,40%{background:white;box-shadow:0 0 6px 2px white;} 50%,100%{background:#ffcc00;box-shadow:0 0 10px 4px #ffcc00;} }
    @keyframes blink-blue { 0%,40%{background:white;box-shadow:0 0 6px 2px white;} 50%,100%{background:#3366ff;box-shadow:0 0 10px 4px #3366ff;} }

    .bulb.red { animation: blink-red 1.8s infinite alternate; }
    .bulb.green { animation: blink-green 1.8s infinite alternate; }
    .bulb.yellow { animation: blink-yellow 1.8s infinite alternate; }
    .bulb.blue { animation: blink-blue 1.8s infinite alternate; }

    .snowflake {
      position: absolute;
      top: -20px;
      color: white;
      font-size: 1.2em;
      text-shadow: 0 0 5px rgba(255,255,255,0.9);
      user-select: none;
      z-index: 5;
      animation: fall linear forwards;
    }

    @keyframes fall {
      to { transform: translateY(105vh) rotate(360deg); }
    }

    #error {
      text-align: center;
      padding: 40px;
      color: #d00;
      font-size: 1.4em;
      max-width: 80%;
      margin: 0 auto;
    }

    #sound-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      font-size: 1.8em;
      color: #FFD700;
      cursor: pointer;
      z-index: 30;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
    }

    #countdown {
      position: fixed;
      bottom: 20px;
      left: 0;
      width: 100%;
      text-align: center;
      font-size: 1.4em;
      font-weight: bold;
      /* –ó–µ–ª—ë–Ω—ã–π —Ü–≤–µ—Ç —Å —Ç–µ–Ω—å—é */
      color: #00aa00;
      text-shadow: 0 0 10px rgba(0, 200, 0, 0.6);
      z-index: 25;
    }
  </style>
</head>
<body>
  <audio id="bg-music" loop preload="auto">
    <source src="music.mp3" type="audio/mpeg">
  </audio>

  <div id="sound-toggle">
    <i class="fas fa-volume-up"></i>
  </div>

  <div class="garland">
    <div class="top-lights" id="top"></div>
    <div class="bottom-lights" id="bottom"></div>
    <div class="left-lights" id="left"></div>
    <div class="right-lights" id="right"></div>
  </div>

  <div id="content">
    <h1>–° –ù–æ–≤—ã–º –≥–æ–¥–æ–º!</h1>
    <div id="wish-container"></div>
    <div id="error" style="display:none;"></div>
  </div>

  <div id="countdown"></div>

  <script>
    const COLORS = ['red', 'green', 'yellow', 'blue'];
    let musicPlayed = false;

    function createBulbs(container, count) {
      for (let i = 0; i < count; i++) {
        const bulb = document.createElement('div');
        bulb.classList.add('bulb', COLORS[Math.floor(Math.random() * COLORS.length)]);
        bulb.style.animationDelay = `${Math.random() * 2}s`;
        container.appendChild(bulb);
      }
    }

    function initGarland() {
      const topBottomCount = Math.max(10, Math.floor(window.innerWidth / 60));
      const leftRightCount = Math.max(8, Math.floor(window.innerHeight / 70));
      createBulbs(document.getElementById('top'), topBottomCount);
      createBulbs(document.getElementById('bottom'), topBottomCount);
      createBulbs(document.getElementById('left'), leftRightCount);
      createBulbs(document.getElementById('right'), leftRightCount);
    }

    function createSnowflake() {
      const snowflake = document.createElement('div');
      snowflake.innerHTML = '‚ùÑ';
      snowflake.classList.add('snowflake');
      snowflake.style.left = `${Math.random() * 100}vw`;
      snowflake.style.fontSize = `${Math.random() * 1.4 + 0.6}em`;
      snowflake.style.animationDuration = `${Math.random() * 10 + 5}s`;
      document.body.appendChild(snowflake);
      setTimeout(() => {
        if (snowflake.parentNode) snowflake.parentNode.removeChild(snowflake);
      }, parseFloat(snowflake.style.animationDuration) * 1000);
    }

    async function loadWish() {
      const urlParams = new URLSearchParams(window.location.search);
      const idParam = parseInt(urlParams.get('id'), 10);
      const wishId = idParam && idParam >= 1 ? idParam : 1;

      try {
        const response = await fetch('wishes.txt?' + Date.now());
        if (!response.ok) throw new Error('–§–∞–π–ª wishes.txt –Ω–µ –Ω–∞–π–¥–µ–Ω');
        const text = await response.text();

        const wishes = text
          .split(/^-{3,}$/m)
          .map(w => w.trim())
          .filter(w => w !== '');

        if (wishId > wishes.length) {
          document.getElementById('error').textContent = `‚ùå –ü–æ–∂–µ–ª–∞–Ω–∏–µ ‚Ññ${wishId} –µ—â—ë –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ`;
          document.getElementById('error').style.display = 'block';
          return;
        }

        document.getElementById('wish-container').innerHTML = wishes[wishId - 1].replace(/\n/g, '<br>');
      } catch (err) {
        console.error(err);
        document.getElementById('error').textContent = '‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ–∂–µ–ª–∞–Ω–∏—è';
        document.getElementById('error').style.display = 'block';
      }
    }

    function initMusic() {
      const audio = document.getElementById('bg-music');
      const toggleBtn = document.getElementById('sound-toggle');
      const icon = toggleBtn.querySelector('i');

      function tryPlay() {
        if (!musicPlayed) {
          audio.volume = 0.25;
          const playPromise = audio.play();
          if (playPromise !== undefined) {
            playPromise.catch(() => {}).then(() => {
              musicPlayed = true;
              icon.className = 'fas fa-volume-up';
            });
          }
        }
      }

      document.body.addEventListener('click', tryPlay, { once: true });

      toggleBtn.addEventListener('click', () => {
        if (audio.paused) {
          audio.play();
          icon.className = 'fas fa-volume-up';
        } else {
          audio.pause();
          icon.className = 'fas fa-volume-mute';
        }
      });
    }

    function updateCountdown() {
      const now = new Date();
      let nextYear = now.getFullYear();
      const nextNewYear = new Date(`January 1, ${nextYear + 1} 00:00:00`);

      const diff = nextNewYear - now;

      if (diff <= 0) {
        document.getElementById('countdown').textContent = '–° –ù–æ–≤—ã–º –≥–æ–¥–æ–º! üéâ';
        return;
      }

      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
      const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((diff % (1000 * 60)) / 1000);

      document.getElementById('countdown').textContent =
        `–î–æ –ù–æ–≤–æ–≥–æ –≥–æ–¥–∞ –æ—Å—Ç–∞–ª–æ—Å—å: ${days}–¥ ${hours}—á ${minutes}–º ${seconds}—Å`;
    }

    window.addEventListener('load', () => {
      initGarland();
      loadWish();
      initMusic();
      setInterval(createSnowflake, 250);
      updateCountdown();
      setInterval(updateCountdown, 1000);
    });
  </script>
</body>
</html>